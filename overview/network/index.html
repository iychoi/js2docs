<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.jetstream-cloud.org/overview/network/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Network configuration and considerations - Jetstream2 Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/cacao.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Network configuration and considerations";
        var mkdocs_page_input_path = "overview/network.md";
        var mkdocs_page_url = "/overview/network/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../images/jetstream-logo-white.svg" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Jetstream2 Main</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Jetstream2 Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../status/">Jetstream2 Status and News</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Jetstream2 Early Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/js2-earlyops-faq/">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Jetstream2 Info</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview-doc/">System Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../keydiff/">Key Differences Between Jetstream 1 and 2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config/">Configuration and specifications</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Network configuration and considerations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Frequently Asked Questions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/general-faq/">General FAQs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/trouble/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/alloc/">Allocations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/software/">Software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../faq/gateways/">Gateways</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">General Usage Information</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/resources/">Jetstream2 Resources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/xsede/">XSEDE Service Units and Jetstream2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/vmsizes/">VM Sizes and Configurations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/quotas/">Quotas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/instancemgt/">Instance Management Actions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/featured/">Featured Images</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/windows/">Microsoft Windows on Jetstream2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/storage/">Storage</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Allocations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/overview/">Allocations Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/trial/">Trial Allocation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/startup/">Startup Allocations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/education/">Education Allocations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/research/">Research Allocations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/supplement/">Supplements (Storage/SUs)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/renew-extend/">Extensions & Renewals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../alloc/faq/">Frequently Asked Questions</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Interfaces</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ui/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exosphere</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/exo/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/login/">Logging In</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/create_instance/">Creating an Instance</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/manage/">Instance Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/exo-filetransfer/">File Transfer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/storage/">Storage Under Exosphere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/push-button-cluster/">Push-button clusters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/exo/troubleshooting/">Exosphere Troubleshooting</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Cacao (aka Atmosphere2)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/intro/">What is Cacao</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/glossary/">Glossary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/ui_basics/">UI Basics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/getting_started/">Getting Started For New Cacao Users</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/credentials/">Credentials</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/workspaces/">Workspaces</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/deployments/">Deployments (Launching a VM)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/alloc/">Choosing Your Allocation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/login/">Logging Into An Instance</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/manage/">Instance Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/storage/">Storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cacao/troubleshooting/">Cacao Troubleshooting</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Horizon</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/intro/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/security_group/">Security Group Management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/network/">Networks in Horizon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/ssh_keys/">SSH Keys in Horizon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/launch/">Launching Instances</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/manage/">Instance Management &ast;</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/storage/">Volumes Under Horizon &ast;</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/manila/">Manila Shares in Horizon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/horizon/troubleshooting/">Horizon Troubleshooting &ast;</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">CLI</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/clients/">Installing Openstack Clients</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/openrc/">Setting up openrc.sh</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Using OpenStack command line</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../ui/cli/managing-ssh-keys/">Managing SSH Keys</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../ui/cli/security_group/">Setting up a Security Group</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../ui/cli/network/">Setting up a Network</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../ui/cli/launch/">Launching a Virtual Machine</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../ui/cli/manage/">Instance Management</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Snapshots & Images</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../ui/cli/snapshot-image/">Overview & Creation</a>
                </li>
                <li class="toctree-l4"><a class="" href="../../ui/cli/snapshot-image/#ImageSharing">Image Sharing</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/deleting/">Deleting Infrastructure in the CLI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/storage/">Storage Under the CLI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/manila/">Manila Shares in the CLI</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ui/cli/troubleshooting/">CLI Troubleshooting</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">General VM Operations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Security</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../general/firewalls/">Firewalls</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/sudo/">Being the root user</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Storage</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Manila</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../general/manila/">Manila</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../general/manilaVM/">Using Manila Share on a VM</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../general/manilaVM-FUSE/">Configuring a Ceph FUSE client</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/object/">Object Store</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/filetransfer/">File Transfer</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Maintenance and Administration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../general/adduser/">Add User to a VM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/installsoftware/">Installing Software on your VM</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Research Software</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../general/jupyter/">Jupyter on Jetstream2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/galaxy/">Galaxy</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Software Collection</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/software/">Jetstream2 Software Collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/usingsoftware/">Using the Jetstream2 Software Collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/licenses/">Software Licenses</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Policies and Best Practices</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/policies/">Acceptable Usage Policies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/export/">Export Control Guidance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/gateways/">AUPs for Jetstream2 Hosted Gateways</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/bestpractice/">Best Practices</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Capabilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">Containers on Jetstream2</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../general/docker/">Docker</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/kubernetes/">Kubernetes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/k8scluster/">Build a K8s cluster</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/k8smanage/">Managing Applications with Kubernetes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/k8svolumes/">Persistent Volumes in Kubernetes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/minikube/">Minikube</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Terraform</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../general/terraform/">Terraform on Jetstream2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../general/advanced_terraform/">Advanced Terraform Topics</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/virtualclusters/">Virtual Clusters on Jetstream2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../general/federating/">Federating Gateways on Jetstream2</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Jetstream2 Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Jetstream2 Info &raquo;</li>
      <li>Network configuration and considerations</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/jetstream-cloud/js2docs/edit/master/docs/overview/network.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="jetstream2-network-configuration-and-policies">Jetstream2 Network Configuration and Policies<a class="headerlink" href="#jetstream2-network-configuration-and-policies" title="Permanent link">&para;</a></h1>
<h3 id="summary-of-network-configuration-and-policies">Summary of Network Configuration and Policies<a class="headerlink" href="#summary-of-network-configuration-and-policies" title="Permanent link">&para;</a></h3>
<h4 id="hardware-configuration">Hardware Configuration:<a class="headerlink" href="#hardware-configuration" title="Permanent link">&para;</a></h4>
<p>The Jetstream2 primary cloud configuation features:</p>
<ul>
<li>100 Gbps network connectivity from the compute hosts to the cloud&rsquo;s internal network infrastructure</li>
<li>4x40 Gbps uplinks from the cloud infrastructure to the data center infrastructure (2x100 planned)</li>
<li>100 Gbps connectivity from the site infrastructure to the Internet2 backbone</li>
<li>100 Gbps connectivity to the XSEDE research network via virtualized link</li>
<li>Individual instances have full access to this infrastructure with no added speed limits.</li>
</ul>
<p><em>It is important to note that connections coming from commercial/commodity internet will likely not be as fast as those coming from Internet2 sites.</em></p>
<h4 id="persistent-ips">Persistent IPs: <a name="PersistentIP"></a><a class="headerlink" href="#persistent-ips" title="Permanent link">&para;</a></h4>
<p>A key difference between Jetstream1 and Jetstream2 is that no special or additional access is required to get a persistent IP address. Some of the GUI interfaces like <a href="/ui/exo/exo.md">Exosphere</a> and <a href="/ui/cacao/overview.md">Cacao</a> release IPs by default when a VM is deleted. <a href="../../ui/horizon/intro/">Horizon</a> and the Jetstream2 <a href="/ui/cli/overview.md">CLI</a> require you to explicitly release the IP address.</p>
<p>We do ask that you release any unused IPs back to the public pool. There are a finite number of IPs available and allocations hoarding them may inadvertently cause issues for other Jetstream2 researchers.</p>
<p>The Jetstream administration team reserves the right to release any IP addresses not associated with a VM as needed.</p>
<h4 id="network-security-policies">Network Security Policies:<a class="headerlink" href="#network-security-policies" title="Permanent link">&para;</a></h4>
<p>In general, Jetstream2 does not restrict inbound or outbound access to virtual machines. There are a handful of blocks at the instutional level that are outside of the control of the Jetstream2 staff. In general, though, the most common Unix service ports (eg. 22/ssh, 80/http, 443/https, etc) are not restricted in any way. Whether they are open by default will be dependent on which user interface you&rsquo;re launching your VM with.</p>
<p>Please refer to the <a href="/faq/security.md#what-is-the-default-security-profile-for-jetstream2-vms">Security FAQ</a> for additional information.</p>
<hr />
<hr />
<hr />
<h3 id="in-depth-exploration-of-jetstream2-networking">In-depth exploration of Jetstream2 Networking<a class="headerlink" href="#in-depth-exploration-of-jetstream2-networking" title="Permanent link">&para;</a></h3>
<p>This section describes the network architecture of Jetstream2&rsquo;s primary cloud at Indiana University. Regional sites may be configured differently.</p>
<p>There are three kinds of networks used on Jetstream2.</p>
<ul>
<li>The <strong>Cluster Network</strong>, which carries all of the tenant/workload/data traffic. It <em>underlays</em> the Neutron overlay networks for cloud workloads. It also carries all storage traffic and OpenStack control plane traffic.</li>
<li>The <strong>Neutron overlay networks</strong>, an entirely software-defined (virtual) networking stack which runs on top of the cluster network.</li>
<li>The <strong>Management Network</strong>, which is fully physically separate from the cluster network. It is used for managing hosts and their <a href="https://en.wikipedia.org/wiki/Dell_DRAC" target="_blank">iDRAC</a>s.</li>
</ul>
<p>This document primarily looks at the <strong>Cluster Network</strong> and may delve into the <strong>Neutron overlay networks</strong>. The Management Network is not in the scope of user-facing documentation.</p>
<h2 id="cluster-network">Cluster Network<a class="headerlink" href="#cluster-network" title="Permanent link">&para;</a></h2>
<p><a href="/attachments/bgp-in-the-data-center.pdf" target="_blank">BGP in the Data Center</a> is recommended reading. It provides background and orientation to Clos networks and BGP the way that it is used here. It is a short, accessible read for someone with general IT networking knowledge. For a quicker version, read chapters 1, 2, 4, and 6. Skim chapters 3 and 5.</p>
<p>The Jetstream2 network is a two-tier spine-and-leaf network in a <a href="https://en.wikipedia.org/wiki/Fat_tree" target="_blank">fat tree</a> or <a href="https://en.wikipedia.org/wiki/Clos_network" target="_blank">Clos</a> topology.</p>
<p><img alt="Jetstream2 physical topology" src="../../images/js2-iu-network.png" /></p>
<p>There are no inter-switch links (ISLs). Traffic that transits the network will generally traverse a leaf switch, a spine switch, and another leaf switch.</p>
<p>Two of the leaf switches connect the Cluster network to the campus WAN and internet. These happen to be the two leaf switches that the control plane nodes are also connected to.</p>
<h3 id="physical-switches">Physical Switches<a class="headerlink" href="#physical-switches" title="Permanent link">&para;</a></h3>
<p>Switches use the <a href="https://www.nvidia.com/en-us/networking/ethernet-switching/cumulus-linux/" target="_blank">Cumulus Linux</a> operating system.</p>
<p>Switch types in the cluster network:</p>
<table>
<thead>
<tr>
<th><strong>Model</strong></th>
<th><strong>Topology Layer</strong></th>
<th><strong>Switch Quantity</strong></th>
<th><strong>Port speed</strong></th>
<th><strong>Port Qty Per Switch</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Mellanox SN4600</td>
<td>Spine</td>
<td>6</td>
<td>100 GbE</td>
<td>64</td>
</tr>
<tr>
<td>Mellanox SN2700</td>
<td>Leaf</td>
<td>37</td>
<td>100 GbE</td>
<td>32</td>
</tr>
</tbody>
</table>
<h3 id="dual-attached-servers">Dual-attached Servers<a class="headerlink" href="#dual-attached-servers" title="Permanent link">&para;</a></h3>
<p>Each host (server) is <em>dual-attached</em> to the Cluster network via two separate leaf switches, using two 100 GbE interfaces. Dual-attaching serves both purposes of redundancy and load-balancing (via equal-cost multipathing).</p>
<p>Redundancy is particularly important here, because many workloads that run on Jetstream2 will <em>not</em> be &lsquo;cloud-native&rsquo; or tolerant of partial-cluster network connectivity failure. Many users will hand-configure their analyses and services on a single instance (virtual machine) that runs on a single host in a single cabinet. Dual-attaching every physical server means that a single network switch failure will not cause a complete or prolonged outage for these non-cloud-native workloads. The physical compute node will quickly notice that one of its network links is offline, and re-route all network traffic to use the remaining functional link.</p>
<h4 id="server-cross-wiring">Server cross-wiring<a class="headerlink" href="#server-cross-wiring" title="Permanent link">&para;</a></h4>
<p>Throughout the cluster, a given host may be variously connected to:</p>
<ul>
<li>2 switches in the same cabinet, or</li>
<li>2 switches in an adjacent cabinet, or</li>
<li>1 switch in the same cabinet and 1 in an adjacent cabinet.</li>
</ul>
<p>The benefit of this cross-wiring between cabinets is increased utilization of switch ports, and reduction of the number of switches needed. This is especially true in Jetstream2 because different types of hosts (e.g. compute, GPU, storage) are different physical sizes, i.e. different densities in a cabinet. The cost of cross-wiring is limited cabinet mobility, because hosts in one cabinet may have many connections to a switch in the next cabinet over, but cabinets are not expected to be moved over the lifetime of Jetstream2.</p>
<h3 id="border-gateway-protocol">Border Gateway Protocol<a class="headerlink" href="#border-gateway-protocol" title="Permanent link">&para;</a></h3>
<p>Jetstream2 uses <a href="https://en.wikipedia.org/wiki/Border_Gateway_Protocol" target="_blank">Border Gateway Protocol</a> (BGP) to route and deliver packets across the entire cluster network. BGP was originally created to handle traffic between large network service providers (a.k.a. carriers), but is also adapted for use within data centers. In this application, BGP replaces use of <a href="https://en.wikipedia.org/wiki/Multi-chassis_link_aggregation_group" target="_blank">MLAG</a> to route traffic over redundant physical paths between switches. Jetstream1 used MLAG, but Jetstream2 does not, for the following reasons:</p>
<ul>
<li>MLAG is fragile when making config changes</li>
<li>&ldquo;Rigorous and conservative interface state management needed. Temporary loops or duplicates not acceptable&rdquo; (<a href="https://web.archive.org/web/20210924222054/https://people.netfilter.org/pablo/netdev0.1/slides/MLAG-on-Linux-Lessons-Learned.pdf" target="_blank">source</a>)</li>
<li>MLAG does not maximize use of aggregate throughout supported by redundant physical links.</li>
<li>MLAG requires inter-switch links (ISLs), which would require many (about 96) additional links between switches, which would require more cabling and purchasing switches with more physical ports.</li>
</ul>
<p>Use of BGP solves all of these drawbacks with MLAG. (See also <a href="https://web.archive.org/web/20210924222054/https://people.netfilter.org/pablo/netdev0.1/slides/MLAG-on-Linux-Lessons-Learned.pdf" target="_blank">MLAG on Linux: Lessons Learned</a>. For a comparison of BGP and other internal routing protocols like Open Shortest Path First (OSPF), see pages 22 and 24 of <a href="../../attachments/bgp-in-the-data-center.pdf" target="_blank">BGP in the Data Center</a> (labeled as pages 14 and 16)).</p>
<p>Some more configuration details:</p>
<ul>
<li>On the Cluster network, peering between all nodes uses eBGP (external BGP), because each host and each leaf (but not spine) switch has its own individually-assigned private autonomous system number (ASN). iBGP (internal BGP) is not used.</li>
<li>The spine switches all share a common ASN, 64512. This avoids path hunting problems as described in pages 26-29 of <a href="../../attachments/bgp-in-the-data-center.pdf" target="_blank">BGP in the Data Center</a> (labeled as pages 18-21).</li>
<li><a href="https://en.wikipedia.org/wiki/Equal-cost_multi-path_routing" target="_blank">Equal-cost multipathing</a> allows packet forwarding to a single destination to be load-balanced across multiple network paths.</li>
</ul>
<h4 id="bgp-unnumbered">BGP Unnumbered<a class="headerlink" href="#bgp-unnumbered" title="Permanent link">&para;</a></h4>
<p>In the cluster network, there is no network <em>bridging</em> or explicitly-defined shared subnets between connected switches (or between switches and hosts). There is only <em>routing</em> of packets between hosts. BGP requires underlying TCP/IP connectivity in order to create a connection, so how can that happen if we have no explicitly-defined subnets or bridges?</p>
<p>In very short, each physical 100 GbE interface on each node (host or switch) has only a <a href="https://en.wikipedia.org/wiki/Link-local_address#IPv6" target="_blank">link-local IPv6 address</a> assigned. IPv6 Router Advertisement (RA) is a link-level protocol that periodically announces an interface&rsquo;s IPv6 addresses, including the link-local address. This is how each node identifies the IP of its peer. RFC 5549 allows a system to advertise IPv4 routes, and route IPv4 packets, over a pure IPv6 network. It also adds an &ldquo;extended nexthop&rdquo; capability to BGP, which negotiates use of RFC 5549 over a BGP peering session.</p>
<p>This strategy is described in greater detail in chapter 4 of <a href="../../attachments/bgp-in-the-data-center.pdf" target="_blank">BGP in the Data Center</a>. The result is that there is no need to define a shared subnet between any nodes. There is also no need to explicitly define neighbor-specific information in a node&rsquo;s configuration. Two peers connected with a network cable will discover each others&rsquo; link-local addresses, exchange IPv6 route advertisements, and initiate a BGP route exchange.</p>
<p><a href="../../images/js2-bgp-unnumbered.png"><img alt="BGP unnumbered packet timeline sequence, from BGP in the Data Center" src="../../images/js2-bgp-unnumbered.png" /></a></p>
<h4 id="routing-on-the-host">Routing on the Host<a class="headerlink" href="#routing-on-the-host" title="Permanent link">&para;</a></h4>
<p>In traditional enterprise networking, packet routing (at layer 3 in the OSI model) is generally performed <em>off the host</em>, i.e., by router hardware that is physically separate from servers running the workloads. Sometimes there is purpose-dedicated router hardware, and sometimes routing is a role performed by the ethernet switches. In either case, servers do not make most packet routing decisions. Servers are <em>bridged</em> to routers at layer 2, on a common subnetwork. Servers determine where to send packets using ARP (Address Resolution Protocol). <strong>This is not how the Jetstream2 Cluster network operates.</strong></p>
<p>Instead, the BGP routing fabric is extended all the way to each server. Each host has its own BGP autonomous system number (ASN), and runs the same FRRouting software as the switches. The host&rsquo;s primary IPv4 address (in private, RFC 1918 space) will appear on the loopback interface, and it is configured as a <code>/32</code> in CIDR notation &ndash; as its very own single-IP subnetwork, not bridged anywhere else!</p>
<p>A server advertises BGP routes for its own internal IPv4 address. These routes are advertised to both switches that the server is attached to, via IPv6 link-local connectivity. This overall strategy is called &ldquo;Routing on the Host&rdquo;, and it is described in chapter 6 of <a href="../../attachments/bgp-in-the-data-center.pdf" target="_blank">BGP in the Data Center</a>.</p>
<p>Again, in the cluster network there is no bridging between physical nodes, only routing.</p>
<p>Some more background reading (if you don&rsquo;t like the book):
- <a href="https://codingpackets.com/blog/linux-routing-on-the-host-with-frr/" target="_blank">Linux Routing On The Host With FRR</a> (<a href="https://web.archive.org/web/20210124124824/https://codingpackets.com/blog/linux-routing-on-the-host-with-frr/" target="_blank">archived version</a>)
- <a href="https://web.archive.org/web/20210305063734/https://cumulusnetworks.com/blog/independence-l2-data-centers/" target="_blank">Independence from L2 Data Centers</a>
- <a href="https://docs.nvidia.com/networking-ethernet-software/cumulus-linux-44/Layer-3/Border-Gateway-Protocol-BGP/" target="_blank">Border Gateway Protocol</a> (<a href="https://web.archive.org/web/20210924225434/https://docs.nvidia.com/networking-ethernet-software/cumulus-linux-43/Layer-3/Border-Gateway-Protocol-BGP/" target="_blank">archived version</a>)</p>
<h3 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h3>
<p>All of this BGP unnumbered architecture supports the &lsquo;Abstraction layer&rsquo; of one or more IPv4 addresses on each host, and the ability to route packets from any host to any other host by its IPv4 address. At this level of abstraction and above, there is no concern with (or visibility of) the BGP routing layer or link-local IPv6 addresses. The Neutron overlay networks do not see it, or know about its complexity.</p>
<hr />
<p>Areas of future discussion:</p>
<h2 id="neutron-overlay-networks">Neutron Overlay Networks<a class="headerlink" href="#neutron-overlay-networks" title="Permanent link">&para;</a></h2>
<p>TODO</p>
<h3 id="layer-2-data-link">Layer 2 (Data Link)<a class="headerlink" href="#layer-2-data-link" title="Permanent link">&para;</a></h3>
<p>VXLAN / Open vSwitch / Linux Bridge?</p>
<h3 id="layer-3-network">Layer 3 (Network)<a class="headerlink" href="#layer-3-network" title="Permanent link">&para;</a></h3>
<p>Neutron Distributed Virtual Routing (DVR)</p>
<p>Typically with DVR, egress traffic leaves a compute node directly to the WAN, while ingress traffic passes through a network node.</p>
<p>See also:
- <a href="https://docs.openstack.org/neutron/latest/admin/config-service-subnets.html">https://docs.openstack.org/neutron/latest/admin/config-service-subnets.html</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../config/" class="btn btn-neutral float-left" title="Configuration and specifications"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../faq/general-faq/" class="btn btn-neutral float-right" title="General FAQs">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright © 2022 The Trustees of Indiana University</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/jetstream-cloud/js2docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../config/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../faq/general-faq/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/matomo.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
